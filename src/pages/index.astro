\---
import BaseLayout from "../layouts/BaseLayout.astro";
import Avatar from "../components/Avatar.tsx";
import TypeWriter from "../components/TypeWriter.tsx";
import Neptune from "../components/Neptune.tsx";

// Fetch real GitHub projects
let featuredProjects = [];

try {
  const username = 'suichanwa';
  const response = await fetch(`https://api.github.com/users/${username}/repos?sort=updated&per_page=100`);
  
  if (response.ok) {
    const repositories = await response.json();
    
    featuredProjects = repositories
      .filter(repo => !repo.fork)
      .sort((a, b) => b.stargazers_count - a.stargazers_count)
      .slice(0, 6)
      .map(repo => ({
        id: repo.id.toString(),
        title: repo.name.replace(/-/g, ' ').replace(/\b\w/g, l => l.toUpperCase()),
        description: repo.description || "A cool project I've been working on",
        technologies: repo.topics || ['JavaScript', 'Web Development'],
        githubUrl: repo.html_url,
        liveUrl: repo.homepage || null,
        stars: repo.stargazers_count,
        forks: repo.forks_count
      }));
  }
} catch (error) {
  console.error('Error fetching GitHub data:', error);
}

// Fallback projects if GitHub API fails
if (featuredProjects.length === 0) {
  featuredProjects = [
    {
      id: "1",
      title: "Portfolio Website",
      description: "A modern portfolio built with Astro and React",
      technologies: ["Astro", "React", "TypeScript", "Tailwind CSS"],
      githubUrl: "https://github.com/suichanwa/portfolio",
    },
    {
      id: "2",
      title: "3D Interactive Resume",
      description: "An interactive resume with Three.js animations",
      technologies: ["Three.js", "React", "GSAP"],
      githubUrl: "https://github.com/suichanwa/3d-resume",
    }
  ];
}

// Stats with consistent styling
const stats = [
  { 
    label: "Years Coding", 
    value: "6", 
    iconSvg: `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
      <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
    </svg>` 
  },
  { 
    label: "Projects Built", 
    value: "50+", 
    iconSvg: `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
      <path stroke-linecap="round" stroke-linejoin="round" d="M17.25 6.75 22.5 12l-5.25 5.25m-10.5 0L1.5 12l5.25-5.25m7.5-3-4.5 16.5" />
    </svg>` 
  }
];
---

<BaseLayout title="Home | My Portfolio">
  <!-- Hero Section -->
  <section id="hero-section" class="py-24 bg-primary-bg min-h-[90vh] flex items-center relative overflow-hidden">
    <div class="container max-w-6xl mx-auto px-4 relative z-10">
      <div class="flex flex-col md:flex-row items-center justify-between">
        <div class="md:w-2/3 text-center md:text-left mb-12 md:mb-0">
          <h1 class="text-4xl md:text-6xl font-bold mb-6 text-text-dark-bg min-h-[8rem] md:min-h-[12rem]">
            <TypeWriter 
              client:load 
              text="a fullstack code monkey" 
              speed={80} 
              delay={500}
              className="block bg-gradient-to-r from-primary-accent to-secondary-accent bg-clip-text text-transparent"
            />
            <TypeWriter 
              client:load 
              text="vibing n making things happen ✨" 
              speed={60}
              delay={2500}
              className="block text-xl md:text-2xl mt-4 text-secondary-accent"
            />
          </h1>
          
          <!-- Stats -->
          <div data-scroll class="flex flex-wrap justify-center md:justify-start gap-6 mb-8 opacity-0">
            {stats.map((stat, i) => (
              <div class="flex items-center gap-3 p-4 bg-base-100/10 backdrop-blur-sm rounded-lg border border-white/10 min-w-[140px]">
                <div class="text-primary-accent" set:html={stat.iconSvg}></div>
                <div class="text-center">
                  <div class="text-lg font-bold text-primary-accent">{stat.value}</div>
                  <div class="text-xs text-base-content/70">{stat.label}</div>
                </div>
              </div>
            ))}
          </div>
        </div>

        <div class="md:w-1/3 flex flex-col items-center">
          <div class="mb-6 p-2 rounded-full border-4 border-primary-accent shadow-2xl bg-gradient-to-br from-primary-accent/20 to-secondary-accent/20 backdrop-blur-sm">
            <Avatar client:load />
          </div>
          
          <!-- CTA Button -->
          <a 
            href="/write-letter"
            class="px-6 py-3 border-2 border-secondary-accent text-secondary-accent font-bold rounded-xl hover:bg-secondary-accent hover:text-white transition-all duration-300 shadow-lg hover:shadow-xl transform hover:-translate-y-1"
          >
            <span class="flex items-center gap-2">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
                <path stroke-linecap="round" stroke-linejoin="round" d="M21.75 6.75v10.5a2.25 2.25 0 0 1-2.25 2.25h-15a2.25 2.25 0 0 1-2.25-2.25V6.75m19.5 0A2.25 2.25 0 0 0 19.5 4.5h-15a2.25 2.25 0 0 0-2.25 2.25m19.5 0v.243a2.25 2.25 0 0 1-1.07 1.916l-7.5 4.615a2.25 2.25 0 0 1-2.36 0L3.32 8.91a2.25 2.25 0 0 1-1.07-1.916V6.75" />
              </svg>
              Write me a letter
            </span>
          </a>
        </div>
      </div>
    </div>
  </section>

  <!-- Projects Section -->
  <section id="projects" class="py-16 bg-base-100/50">
    <div class="container max-w-6xl mx-auto px-4">
      <div data-scroll class="text-center mb-12 opacity-0">
        <h2 class="text-3xl md:text-4xl font-bold text-text-dark-bg mb-4">Featured Projects</h2>
        <p class="text-lg text-base-content/70 max-w-2xl mx-auto">
          A collection of projects that showcase my technical skills and problem-solving approach.
        </p>
      </div>
      
      <div data-scroll class="grid md:grid-cols-2 lg:grid-cols-3 gap-6 opacity-0">
        {featuredProjects.map((project, index) => (
          <div class="bg-base-200/50 backdrop-blur-sm rounded-xl border border-white/10 hover:border-primary-accent/30 transition-all duration-300 overflow-hidden">
            <div class="p-6">
              <!-- Stats badges -->
              {(project.stars !== undefined || project.forks !== undefined) && (
                <div class="flex items-center gap-2 text-xs mb-4">
                  {project.stars !== undefined && project.stars > 0 && (
                    <div class="flex items-center gap-1 px-2 py-1 bg-yellow-500/10 text-yellow-600 rounded-full">
                      <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
                      </svg>
                      <span>{project.stars}</span>
                    </div>
                  )}
                  {project.forks !== undefined && project.forks > 0 && (
                    <div class="flex items-center gap-1 px-2 py-1 bg-blue-500/10 text-blue-600 rounded-full">
                      <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.707 3.293a1 1 0 010 1.414L5.414 7H11a7 7 0 017 7v2a1 1 0 11-2 0v-2a5 5 0 00-5-5H5.414l2.293 2.293a1 1 0 11-1.414 1.414L2.586 7a2 2 0 010-2.828l3.707-3.707a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                      </svg>
                      <span>{project.forks}</span>
                    </div>
                  )}
                </div>
              )}

              <!-- Project title and description -->
              <h3 class="text-xl font-bold text-text-dark-bg mb-2 hover:text-primary-accent transition-colors">
                {project.title}
              </h3>
              <p class="text-base-content/80 text-sm mb-4 line-clamp-2">
                {project.description}
              </p>

              <!-- Technology stack -->
              <div class="flex flex-wrap gap-1 mb-4">
                {project.technologies.slice(0, 3).map((tech) => (
                  <span class="px-2 py-1 bg-base-300/50 text-base-content/70 text-xs rounded-md">
                    {tech}
                  </span>
                ))}
                {project.technologies.length > 3 && (
                  <span class="px-2 py-1 bg-primary-accent/10 text-primary-accent text-xs rounded-md">
                    +{project.technologies.length - 3}
                  </span>
                )}
              </div>
            </div>

            <!-- Action buttons -->
            <div class="px-6 pb-6">
              <div class="flex gap-2">
                <a 
                  href={project.githubUrl}
                  target="_blank"
                  rel="noopener noreferrer"
                  class="flex-1 flex items-center justify-center gap-2 px-3 py-2 bg-base-300/50 hover:bg-base-300 text-base-content hover:text-primary-accent rounded-lg transition-all text-sm"
                >
                  <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                  </svg>
                  Code
                </a>
                
                {project.liveUrl && (
                  <a 
                    href={project.liveUrl}
                    target="_blank"
                    rel="noopener noreferrer"
                    class="flex-1 flex items-center justify-center gap-2 px-3 py-2 bg-primary-accent hover:bg-primary-accent/90 text-white rounded-lg transition-all text-sm"
                  >
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width={2} d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                    </svg>
                    Live
                  </a>
                )}
              </div>
            </div>
          </div>
        ))}
      </div>

      <!-- View all projects link -->
      <div data-scroll class="text-center mt-12 opacity-0">
        <a 
          href="https://github.com/suichanwa"
          target="_blank"
          rel="noopener noreferrer"
          class="inline-flex items-center gap-2 px-6 py-3 bg-base-200/50 hover:bg-base-200 text-base-content hover:text-primary-accent rounded-lg transition-all border border-white/10 hover:border-primary-accent/30"
        >
          <span>View All Projects on GitHub</span>
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width={2} d="M17 8l4 4m0 0l-4 4m4-4H3" />
          </svg>
        </a>
      </div>
    </div>
  </section>

  <!-- Neptune Widget Section -->
  <section id="neptune-widget" class="py-16 bg-primary-bg relative overflow-hidden">
    <!-- Animated background elements -->
    <div class="absolute inset-0 overflow-hidden pointer-events-none">
      <div class="neptune-stars"></div>
      <div class="neptune-glow"></div>
    </div>

    <div class="container max-w-6xl mx-auto px-4 relative z-10">
      <div data-scroll class="text-center mb-8 opacity-0">
        <p class="text-lg sm:text-xl md:text-2xl max-w-2xl mx-auto neptune-subtitle">
          <span class="neptune-text-wrapper">
            <span class="neptune-text-glow"></span>
            <span class="neptune-text-content">
              Do you often wonder what time it is on <span class="neptune-highlight">Neptune</span>?
            </span>
          </span>
        </p>
      </div>

      <div data-scroll class="max-w-5xl mx-auto opacity-0">
        <Neptune client:load />
      </div>
    </div>
  </section>
</BaseLayout>

<script>
  // Scroll animations
  document.addEventListener('DOMContentLoaded', () => {
    const scrollElements = document.querySelectorAll('[data-scroll]');
    
    const elementInView = (el: Element, dividend = 1) => {
      const elementTop = el.getBoundingClientRect().top;
      return (
        elementTop <= 
        (window.innerHeight || document.documentElement.clientHeight) / dividend
      );
    };
    
    const displayScrollElement = (element: HTMLElement) => {
      element.style.opacity = '1';
      element.style.transform = 'translateY(0)';
    };
    
    const hideScrollElement = (element: HTMLElement) => {
      element.style.opacity = '0';
      element.style.transform = 'translateY(20px)';
    };
    
    const handleScrollAnimation = () => {
      scrollElements.forEach((el) => {
        const htmlEl = el as HTMLElement;
        if (elementInView(el, 1.25)) {
          displayScrollElement(htmlEl);
        } else {
          hideScrollElement(htmlEl);
        }
      });
    };
    
    scrollElements.forEach(el => {
      const htmlEl = el as HTMLElement;
      htmlEl.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
    });
    
    window.addEventListener('scroll', () => {
      handleScrollAnimation();
    });
    
    handleScrollAnimation();
  });
</script>

<style>
  [data-scroll] {
    opacity: 0;
    transform: translateY(20px);
    transition: opacity 0.6s ease, transform 0.6s ease;
  }

  /* Neptune Section Styling */
  #neptune-widget {
    background: linear-gradient(180deg, 
      #0f1419 0%, 
      #1a1f35 50%, 
      #0f1419 100%
    );
  }

  /* Animated starfield background */
  .neptune-stars {
    position: absolute;
    width: 100%;
    height: 100%;
    background-image: 
      radial-gradient(2px 2px at 20px 30px, #5ba3ff, transparent),
      radial-gradient(2px 2px at 60px 70px, #3d8eff, transparent),
      radial-gradient(1px 1px at 50px 50px, #88ccff, transparent),
      radial-gradient(1px 1px at 130px 80px, #5ba3ff, transparent),
      radial-gradient(2px 2px at 90px 10px, #3d8eff, transparent);
    background-size: 200px 200px;
    animation: twinkle 8s ease-in-out infinite;
    opacity: 0.6;
  }

  @keyframes twinkle {
    0%, 100% { opacity: 0.4; }
    50% { opacity: 0.8; }
  }

  /* Neptune glow effect */
  .neptune-glow {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 600px;
    height: 600px;
    background: radial-gradient(circle, 
      rgba(91, 163, 255, 0.15) 0%, 
      rgba(59, 130, 246, 0.08) 30%, 
      transparent 70%
    );
    animation: pulse-glow 6s ease-in-out infinite;
    pointer-events: none;
  }

  @keyframes pulse-glow {
    0%, 100% { 
      transform: translate(-50%, -50%) scale(1);
      opacity: 0.3;
    }
    50% { 
      transform: translate(-50%, -50%) scale(1.1);
      opacity: 0.5;
    }
  }

  /* Subtitle text styling */
  .neptune-subtitle {
    font-family: 'Georgia', serif;
    font-weight: 400;
    line-height: 1.6;
    letter-spacing: 0.02em;
    position: relative;
  }

  .neptune-text-wrapper {
    position: relative;
    display: inline-block;
  }

  /* Animated glow behind text */
  .neptune-text-glow {
    position: absolute;
    inset: -10px;
    background: radial-gradient(ellipse at center, 
      rgba(91, 163, 255, 0.3) 0%, 
      transparent 60%
    );
    filter: blur(20px);
    animation: text-glow-pulse 4s ease-in-out infinite;
    pointer-events: none;
  }

  @keyframes text-glow-pulse {
    0%, 100% { opacity: 0.4; transform: scale(0.95); }
    50% { opacity: 0.7; transform: scale(1.05); }
  }

  .neptune-text-content {
    position: relative;
    display: inline-block;
    color: #5ba3ff;
    text-shadow: 
      0 0 20px rgba(91, 163, 255, 0.5),
      0 0 40px rgba(59, 130, 246, 0.3),
      0 2px 4px rgba(0, 0, 0, 0.5);
    animation: subtle-float 3s ease-in-out infinite;
  }

  @keyframes subtle-float {
    0%, 100% { transform: translateY(0px); }
    50% { transform: translateY(-3px); }
  }

  /* Neptune highlight word */
  .neptune-highlight {
    font-weight: 600;
    color: #88ccff;
    text-shadow: 
      0 0 30px rgba(136, 204, 255, 0.8),
      0 0 60px rgba(91, 163, 255, 0.5),
      0 0 90px rgba(59, 130, 246, 0.3),
      0 2px 6px rgba(0, 0, 0, 0.8);
    animation: neptune-shimmer 3s ease-in-out infinite;
    display: inline-block;
    position: relative;
  }

  @keyframes neptune-shimmer {
    0%, 100% { 
      filter: brightness(1);
      text-shadow: 
        0 0 30px rgba(136, 204, 255, 0.8),
        0 0 60px rgba(91, 163, 255, 0.5),
        0 2px 6px rgba(0, 0, 0, 0.8);
    }
    50% { 
      filter: brightness(1.3);
      text-shadow: 
        0 0 40px rgba(136, 204, 255, 1),
        0 0 80px rgba(91, 163, 255, 0.7),
        0 0 120px rgba(59, 130, 246, 0.4),
        0 2px 8px rgba(0, 0, 0, 0.9);
    }
  }

  /* Responsive adjustments */
  @media (max-width: 640px) {
    .neptune-glow {
      width: 400px;
      height: 400px;
    }

    .neptune-text-content {
      font-size: 1.125rem;
    }

    .neptune-stars {
      background-size: 150px 150px;
    }
  }

  /* Smooth fade-in on scroll */
  .neptune-subtitle {
    transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1);
  }
</style>