---
import BaseLayout from "../layouts/BaseLayout.astro";
import Avatar from "../components/Avatar.tsx";
import TypeWriter from "../components/TypeWriter.tsx";
import Neptune from "../components/Neptune.tsx";

// Define types for projects
interface GitHubRepo {
  id: number;
  name: string;
  description: string | null;
  html_url: string;
  homepage: string | null;
  stargazers_count: number;
  forks_count: number;
  topics: string[];
  fork: boolean;
}

interface Project {
  id: string;
  title: string;
  description: string;
  technologies: string[];
  githubUrl: string;
  liveUrl?: string;
  stars?: number;
  forks?: number;
}

// Fetch real GitHub projects
let featuredProjects: Project[] = [];

try {
  const username = 'suichanwa';
  const response = await fetch(`https://api.github.com/users/${username}/repos?sort=updated&per_page=100`);
  
  if (response.ok) {
    const repositories: GitHubRepo[] = await response.json();
    
    featuredProjects = repositories
      .filter((repo: GitHubRepo) => !repo.fork)
      .sort((a: GitHubRepo, b: GitHubRepo) => b.stargazers_count - a.stargazers_count)
      .slice(0, 6)
      .map((repo: GitHubRepo) => ({
        id: repo.id.toString(),
        title: repo.name,
        description: repo.description || "No description available",
        technologies: repo.topics || [],
        githubUrl: repo.html_url,
        liveUrl: repo.homepage || undefined,
        stars: repo.stargazers_count,
        forks: repo.forks_count
      }));
  }
} catch (error) {
  console.error('Error fetching GitHub data:', error);
}

// Fallback projects if GitHub API fails
if (featuredProjects.length === 0) {
  featuredProjects = [
    {
      id: "1",
      title: "Portfolio Website",
      description: "A modern portfolio built with Astro and React",
      technologies: ["Astro", "React", "TypeScript", "Tailwind CSS"],
      githubUrl: "https://github.com/suichanwa/portfolio",
    },
    {
      id: "2",
      title: "Coming Soon",
      description: "More projects on the way",
      technologies: [],
      githubUrl: "#"
    }
  ];
}

// Stats with consistent styling
const stats = [
  { label: "Years Coding", value: "6", icon: "clock" },
  { label: "Projects Built", value: "50+", icon: "code" }
];
---

<BaseLayout title="Home | My Portfolio" enableNeptuneTransition={true}>
  <!-- Hero Section -->
  <section id="hero-section" class="py-24 bg-primary-bg min-h-[90vh] flex items-center relative overflow-hidden">
    <div class="container max-w-6xl mx-auto px-4 relative z-10">
      <div class="flex flex-col md:flex-row items-center justify-between gap-12">
        <div class="md:w-2/3 text-center md:text-left">
          <h1 class="text-4xl md:text-6xl font-bold mb-6 text-text-dark-bg min-h-[8rem] md:min-h-[12rem]">
            <TypeWriter 
              client:load 
              text="a fullstack code monkey" 
              speed={80} 
              delay={500}
              className="block bg-gradient-to-r from-primary-accent to-secondary-accent bg-clip-text text-transparent"
            />
            <span class="flex items-center justify-center md:justify-start gap-2 text-xl md:text-2xl mt-4 text-secondary-accent">
              <TypeWriter 
                client:load 
                text="vibing n making things happen" 
                speed={60}
                delay={2500}
                className="inline-block"
              />
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 inline-block">
                <path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904 9 18.75l-.813-2.846a4.5 4.5 0 0 0-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 0 0 3.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 0 0 3.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 0 0-3.09 3.09ZM18.259 8.715 18 9.75l-.259-1.035a3.375 3.375 0 0 0-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 0 0 2.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 0 0 2.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 0 0-2.456 2.456ZM16.894 20.567 16.5 21.75l-.394-1.183a2.25 2.25 0 0 0-1.423-1.423L13.5 18.75l1.183-.394a2.25 2.25 0 0 0 1.423-1.423l.394-1.183.394 1.183a2.25 2.25 0 0 0 1.423 1.423l1.183.394-1.183.394a2.25 2.25 0 0 0-1.423 1.423Z" />
              </svg>
            </span>
          </h1>
          
          <!-- Optimized Stats -->
          <div class="flex flex-wrap justify-center md:justify-start gap-6 mb-8">
            {stats.map((stat) => (
              <div class="flex items-center gap-3 p-4 bg-base-100/20 rounded-lg border border-white/10 min-w-[140px] hover:border-white/20 transition-colors">
                {stat.icon === 'clock' ? (
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 text-primary-accent">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
                  </svg>
                ) : (
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 text-primary-accent">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M17.25 6.75 22.5 12l-5.25 5.25m-10.5 0L1.5 12l5.25-5.25m7.5-3-4.5 16.5" />
                  </svg>
                )}
                <div>
                  <div class="text-2xl font-bold text-primary-accent">{stat.value}</div>
                  <div class="text-sm text-white/70">{stat.label}</div>
                </div>
              </div>
            ))}
          </div>
        </div>
        
        <div class="md:w-1/3 flex justify-center">
          <Avatar client:load />
        </div>
      </div>
    </div>
  </section>

  <!-- Projects Section -->
  <section id="projects" class="py-16 bg-base-100/50">
    <div class="container max-w-6xl mx-auto px-4">
      <h2 class="text-3xl font-bold text-center mb-12 text-primary-accent">
        Featured Projects
      </h2>
      
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {featuredProjects.map((project: Project) => (
          <div class="bg-base-200 rounded-xl p-6 hover:shadow-xl transition-all hover:scale-105">
            <h3 class="text-xl font-bold mb-2">{project.title}</h3>
            <p class="text-base-content/80 mb-4">{project.description}</p>
            
            {project.technologies && project.technologies.length > 0 && (
              <div class="flex flex-wrap gap-2 mb-4">
                {project.technologies.map((tech: string) => (
                  <span class="badge badge-primary badge-sm">{tech}</span>
                ))}
              </div>
            )}
            
            <div class="flex gap-4 items-center">
              <a 
                href={project.githubUrl} 
                target="_blank" 
                rel="noopener noreferrer"
                class="btn btn-sm btn-primary"
              >
                View on GitHub
              </a>
              
              {project.liveUrl && (
                <a 
                  href={project.liveUrl} 
                  target="_blank"
                  rel="noopener noreferrer"
                  class="btn btn-sm btn-ghost"
                >
                  Live Demo
                </a>
              )}
            </div>
            
            {(project.stars !== undefined || project.forks !== undefined) && (
              <div class="flex gap-4 mt-4 text-sm text-base-content/60">
                {project.stars !== undefined && (
                  <span class="inline-flex items-center gap-1">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-4 h-4 text-primary-accent">
                      <path fill-rule="evenodd" d="M10.788 3.21a.75.75 0 0 1 1.424 0l1.778 5.51 5.791.043a.75.75 0 0 1 .442 1.346l-4.694 3.42 1.694 5.534a.75.75 0 0 1-1.147.84L12 16.897l-4.076 3.006a.75.75 0 0 1-1.147-.84l1.694-5.534-4.694-3.42a.75.75 0 0 1 .442-1.346l5.79-.043 1.78-5.51Z" clip-rule="evenodd" />
                    </svg>
                    {project.stars}
                  </span>
                )}
                {project.forks !== undefined && (
                  <span class="inline-flex items-center gap-1">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" class="w-4 h-4 text-secondary-accent">
                      <circle cx="6" cy="4" r="2"></circle>
                      <circle cx="18" cy="4" r="2"></circle>
                      <circle cx="12" cy="20" r="2"></circle>
                      <path d="M12 18V9"></path>
                      <path d="M12 9C12 7.343 10.657 6 9 6H6"></path>
                      <path d="M12 9C12 7.343 13.343 6 15 6H18"></path>
                    </svg>
                    {project.forks}
                  </span>
                )}
              </div>
            )}
          </div>
        ))}
      </div>
    </div>
  </section>

  <!-- Neptune Widget Section -->
  <section id="neptune-widget" class="py-16 relative overflow-hidden">
    <div class="container max-w-6xl mx-auto px-4 relative z-10">
      <h2 class="text-3xl font-bold text-center mb-12 text-primary-accent inline-flex items-center justify-center gap-3 w-full">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6 text-secondary-accent">
          <circle cx="12" cy="12" r="6"></circle>
          <path d="M4 12c2.5-2.5 6-4 8-4s5.5 1.5 8 4"></path>
          <path d="M4 12c2.5 2.5 6 4 8 4s5.5-1.5 8-4"></path>
        </svg>
        Neptune Widget
      </h2>
      <Neptune client:load />
    </div>
  </section>
</BaseLayout>

<style>
  @media (prefers-reduced-motion: reduce) {
    * {
      animation-duration: 0.01ms !important;
      animation-iteration-count: 1 !important;
      transition-duration: 0.01ms !important;
    }
  }
</style>
