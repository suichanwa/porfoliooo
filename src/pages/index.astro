---
import BaseLayout from "../layouts/BaseLayout.astro";
import Avatar from "../components/Avatar.tsx";
import TypeWriter from "../components/TypeWriter.tsx";
import Neptune from "../components/Neptune.tsx";
import FeaturedProjects from "../components/FeaturedProjects.astro";

interface GitHubRepo {
  id: number;
  name: string;
  description: string | null;
  html_url: string;
  homepage: string | null;
  stargazers_count: number;
  forks_count: number;
  topics: string[];
  fork: boolean;
}

interface Project {
  id: string;
  title: string;
  description: string;
  technologies: string[];
  githubUrl: string;
  liveUrl?: string;
  stars?: number;
  forks?: number;
}

// Fetch real GitHub projects
let featuredProjects: Project[] = [];

try {
  const username = 'suichanwa';
  const response = await fetch(`https://api.github.com/users/${username}/repos?sort=updated&per_page=100`);
  
  if (response.ok) {
    const repositories: GitHubRepo[] = await response.json();
    
    featuredProjects = repositories
      .filter((repo: GitHubRepo) => !repo.fork)
      .sort((a: GitHubRepo, b: GitHubRepo) => b.stargazers_count - a.stargazers_count)
      .slice(0, 6)
      .map((repo: GitHubRepo) => ({
        id: repo.id.toString(),
        title: repo.name,
        description: repo.description || "No description available",
        technologies: repo.topics || [],
        githubUrl: repo.html_url,
        liveUrl: repo.homepage || undefined,
        stars: repo.stargazers_count,
        forks: repo.forks_count
      }));
  }
} catch (error) {
  console.error('Error fetching GitHub data:', error);
}

// Fallback projects if GitHub API fails
if (featuredProjects.length === 0) {
  featuredProjects = [
    {
      id: "1",
      title: "Portfolio Website",
      description: "A modern portfolio built with Astro and React",
      technologies: ["Astro", "React", "TypeScript", "Tailwind CSS"],
      githubUrl: "https://github.com/suichanwa/portfolio",
    },
    {
      id: "2",
      title: "Coming Soon",
      description: "More projects on the way",
      technologies: [],
      githubUrl: "#"
    }
  ];
}

// Stats with consistent styling
const stats = [
  { label: "Years Coding", value: "6", icon: "clock" },
  { label: "Projects Built", value: "50+", icon: "code" }
];
---

<BaseLayout title="Home | My Portfolio" enableNeptuneTransition={true}>
  <!-- Hero Section -->
  <section id="hero-section" class="py-24 bg-transparent min-h-[90vh] flex items-center relative overflow-hidden">
    <div class="container max-w-6xl mx-auto px-4 relative z-10">
      <div class="flex flex-col md:flex-row items-center justify-between gap-12">
        <div class="md:w-2/3 text-center md:text-left">
          <h1 class="text-4xl md:text-6xl font-bold mb-6 text-text-dark-bg min-h-[8rem] md:min-h-[12rem]">
            <TypeWriter 
              client:load 
              text="fullstack developer" 
              speed={80} 
              delay={500}
              className="block bg-gradient-to-r from-primary-accent to-secondary-accent bg-clip-text text-transparent"
            />
            <span class="flex items-center justify-center md:justify-start gap-2 text-xl md:text-2xl mt-4 text-secondary-accent">
              <TypeWriter 
                client:load 
                text="vibing n making things happen" 
                speed={60}
                delay={2500}
                className="inline-block"
              />
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 inline-block">
                <path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904 9 18.75l-.813-2.846a4.5 4.5 0 0 0-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 0 0 3.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 0 0 3.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 0 0-3.09 3.09ZM18.259 8.715 18 9.75l-.259-1.035a3.375 3.375 0 0 0-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 0 0 2.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 0 0 2.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 0 0-2.456 2.456ZM16.894 20.567 16.5 21.75l-.394-1.183a2.25 2.25 0 0 0-1.423-1.423L13.5 18.75l1.183-.394a2.25 2.25 0 0 0 1.423-1.423l.394-1.183.394 1.183a2.25 2.25 0 0 0 1.423 1.423l1.183.394-1.183.394a2.25 2.25 0 0 0-1.423 1.423Z" />
              </svg>
            </span>
          </h1>
          
          <!-- Optimized Stats -->
          <div class="flex flex-wrap justify-center md:justify-start gap-6 mb-8">
            {stats.map((stat) => (
              <div class="hero-stat">
                {stat.icon === 'clock' ? (
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="hero-stat__icon">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
                  </svg>
                ) : (
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="hero-stat__icon">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M17.25 6.75 22.5 12l-5.25 5.25m-10.5 0L1.5 12l5.25-5.25m7.5-3-4.5 16.5" />
                  </svg>
                )}
                <div>
                  <div class="hero-stat__value">{stat.value}</div>
                  <div class="hero-stat__label">{stat.label}</div>
                </div>
              </div>
            ))}
          </div>
        </div>
        
        <div class="md:w-1/3 flex justify-center">
          <Avatar client:load />
        </div>
      </div>
    </div>
  </section>

  <FeaturedProjects projects={featuredProjects} />

  <!-- Neptune Widget Section -->
  <section id="neptune-widget" class="py-16 relative overflow-hidden">
    <div class="container max-w-6xl mx-auto px-4 relative z-10">
      <h2 class="text-3xl font-bold text-center mb-12 text-primary-accent inline-flex items-center justify-center gap-3 w-full">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6 text-secondary-accent">
          <circle cx="12" cy="12" r="6"></circle>
          <path d="M4 12c2.5-2.5 6-4 8-4s5.5 1.5 8 4"></path>
          <path d="M4 12c2.5 2.5 6 4 8 4s5.5-1.5 8-4"></path>
        </svg>
        Neptune Widget
      </h2>
      <Neptune client:load />
    </div>
  </section>
</BaseLayout>

<style>
  .hero-stat {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.9rem 1rem;
    border-radius: 16px;
    min-width: 140px;
    background: rgba(12, 16, 26, 0.55);
    border: 1px solid rgba(180, 194, 214, 0.12);
    box-shadow: 0 12px 22px rgba(2, 4, 10, 0.35);
    backdrop-filter: blur(6px);
    -webkit-backdrop-filter: blur(6px);
    transition: transform 240ms ease, box-shadow 240ms ease, border-color 240ms ease, background 240ms ease;
  }

  .hero-stat__icon {
    width: 1.5rem;
    height: 1.5rem;
    color: rgba(167, 179, 198, 0.7);
  }

  .hero-stat__value {
    font-size: 1.5rem;
    font-weight: 700;
    color: rgba(238, 244, 255, 0.88);
    line-height: 1.1;
  }

  .hero-stat__label {
    font-size: 0.85rem;
    color: rgba(198, 206, 222, 0.6);
  }

  .hero-stat:hover {
    transform: translateY(-2px);
    background: rgba(16, 20, 32, 0.6);
    border-color: rgba(180, 194, 214, 0.2);
    box-shadow: 0 16px 26px rgba(2, 4, 10, 0.45);
  }

  @media (prefers-reduced-motion: reduce) {
    .hero-stat {
      transition-duration: 0.01ms !important;
    }
  }
</style>
