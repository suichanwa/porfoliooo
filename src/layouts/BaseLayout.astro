---
interface Props {
  title?: string;
  theme?: string;
}

const { 
  title = "My Portfolio",
  theme = "dark" 
} = Astro.props;

import '../styles/global.css';
import '../styles/colors.css';
import Navigation from '../components/Navigation.tsx';
import StarryBackground from '../components/StarryBackground.tsx';
---

<html lang="en" data-theme={theme} class="h-full">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{title}</title>
    
    <!-- Enhanced Security Headers -->
    <meta http-equiv="Content-Security-Policy" content="
      default-src 'self';
      script-src 'self' 'unsafe-inline' 'unsafe-eval' 
        https://*.firebase.com 
        https://*.googleapis.com 
        https://www.gstatic.com
        https://unpkg.com
        https://*.firebaseapp.com
        https://apis.google.com;
      style-src 'self' 'unsafe-inline' 
        https://fonts.googleapis.com;
      font-src 'self' 
        https://fonts.gstatic.com
        data:;
      img-src 'self' data: blob: 
        https://*.firebase.com 
        https://*.googleapis.com
        https://*.firebaseapp.com
        https://storage.googleapis.com
        https://images-na.ssl-images-amazon.com
        https://i.imgur.com;
      connect-src 'self' 
        https://*.firebase.com 
        https://*.googleapis.com 
        https://*.firebaseapp.com
        https://api.github.com
        https://firestore.googleapis.com
        wss://*.firebase.com;
      frame-src 'self'
        https://*.firebase.com
        https://*.firebaseapp.com;
      object-src 'none';
      base-uri 'self';
      form-action 'self';
      upgrade-insecure-requests;
    " />
    
    <!-- Additional Security Headers -->
    <meta http-equiv="X-Frame-Options" content="SAMEORIGIN" />
    <meta http-equiv="X-Content-Type-Options" content="nosniff" />
    <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin" />
    <meta http-equiv="X-XSS-Protection" content="1; mode=block" />
    <meta http-equiv="Permissions-Policy" content="
      geolocation=(), 
      microphone=(), 
      camera=(), 
      fullscreen=(self), 
      payment=(),
      usb=(),
      magnetometer=(),
      gyroscope=(),
      accelerometer=()
    " />
    <meta http-equiv="Strict-Transport-Security" content="max-age=31536000; includeSubDomains; preload" />
    
    <!-- DNS Prefetch and Preconnect for Performance -->
    <link rel="dns-prefetch" href="//fonts.googleapis.com">
    <link rel="dns-prefetch" href="//fonts.gstatic.com">
    <link rel="dns-prefetch" href="//firebase.googleapis.com">
    <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <!-- Fonts with SRI for added security -->
    <link 
      rel="stylesheet" 
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
      crossorigin="anonymous"
    >
    
    <!-- Favicon and PWA meta tags -->
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <link rel="icon" type="image/png" href="/favicon.png">
    <meta name="theme-color" content="#5e9fff">
    <meta name="description" content="My personal portfolio showcasing projects, books, and thoughts">
    
    <!-- Open Graph meta tags for social sharing -->
    <meta property="og:title" content={title}>
    <meta property="og:description" content="My personal portfolio showcasing projects, books, and thoughts">
    <meta property="og:type" content="website">
    <meta property="og:image" content="/og-image.png">
    
    <!-- Twitter Card meta tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content={title}>
    <meta name="twitter:description" content="My personal portfolio showcasing projects, books, and thoughts">
    <meta name="twitter:image" content="/og-image.png">
    
    {import.meta.env.DEV && <meta name="robots" content="noindex, nofollow">}
  </head>
  <body class="flex flex-col min-h-screen bg-base-100 text-base-content font-['Poppins'] relative">
    <!-- Starry background -->
    <StarryBackground client:load />
    
    <!-- Navigation -->
    <Navigation client:load />

    <!-- Main content -->
    <main class="container mx-auto px-4 py-8 flex-1 relative z-10">
      <slot />
    </main>

    <!-- Structured Data for SEO -->
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "Person",
        "name": "Your Name",
        "url": "https://your-domain.com",
        "sameAs": [
          "https://github.com/yourusername",
          "https://linkedin.com/in/yourusername"
        ],
        "jobTitle": "Software Developer",
        "description": "Full-stack developer passionate about creating elegant solutions"
      }
    </script>

    <!-- Security monitoring script (optional) -->
    <script>
      // Report CSP violations for monitoring
      if ('SecurityPolicyViolationEvent' in window) {
        window.addEventListener('securitypolicyviolation', (e) => {
          console.warn('CSP Violation:', {
            blockedURI: e.blockedURI,
            violatedDirective: e.violatedDirective,
            originalPolicy: e.originalPolicy,
            disposition: e.disposition
          });
          
          // Optional: Send to analytics or monitoring service
          // gtag('event', 'exception', {
          //   description: `CSP Violation: ${e.violatedDirective}`,
          //   fatal: false
          // });
        });
      }

      if (window.self !== window.top) {
        console.warn('Page loaded in frame - potential clickjacking attempt');
      }

      if (!import.meta.env.DEV) {
        document.addEventListener('contextmenu', (e) => {
          e.preventDefault();
        });
      }
    </script>
  </body>
</html>